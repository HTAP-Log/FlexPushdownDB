project("normal-core" VERSION "${PROJECT_VERSION}" LANGUAGES C CXX)


#-----------------------------------------------------------------------------------------------------------------------
# Target
#-----------------------------------------------------------------------------------------------------------------------

add_library(normal-core STATIC
        src/message/StartMessage.cpp include/normal/core/message/StartMessage.h
        src/message/Envelope.cpp include/normal/core/message/Envelope.h
        include/normal/core/Globals.h
        src/message/CompleteMessage.cpp include/normal/core/message/CompleteMessage.h
        src/Normal.cpp include/normal/core/Normal.h
        src/OperatorActor.cpp include/normal/core/OperatorActor.h
        src/Operator.cpp include/normal/core/Operator.h
        src/OperatorContext.cpp include/normal/core/OperatorContext.h
        src/OperatorManager.cpp include/normal/core/OperatorManager.h
        src/message/Message.cpp include/normal/core/message/Message.h
        src/ATTIC/Cache.cpp include/normal/core/ATTIC/Cache.h
        src/Actors.cpp include/normal/core/Actors.h
        src/OperatorDirectory.cpp include/normal/core/OperatorDirectory.h
        src/OperatorDirectoryEntry.cpp include/normal/core/OperatorDirectoryEntry.h
        src/OperatorRelationshipType.cpp include/normal/core/OperatorRelationshipType.h
        src/LocalOperatorDirectory.cpp include/normal/core/LocalOperatorDirectory.h
        src/LocalOperatorDirectoryEntry.cpp include/normal/core/LocalOperatorDirectoryEntry.h
        include/normal/core/type/Type.h
        src/type/DecimalType.cpp include/normal/core/type/DecimalType.h
        src/type/Types.cpp include/normal/core/type/Types.h
        src/type/Float64Type.cpp include/normal/core/type/Float64Type.h
        src/type/Integer32Type.cpp include/normal/core/type/Integer32Type.h
        src/type/Integer64Type.cpp include/normal/core/type/Integer64Type.h
        src/cache/LoadRequestMessage.cpp include/normal/core/cache/LoadRequestMessage.h
        src/cache/StoreRequestMessage.cpp include/normal/core/cache/StoreRequestMessage.h
        src/cache/EvictRequestMessage.cpp include/normal/core/cache/EvictRequestMessage.h
        src/cache/EvictionPolicyType.cpp include/normal/core/cache/EvictionPolicyType.h
        src/cache/LoadResponseMessage.cpp include/normal/core/cache/LoadResponseMessage.h
        src/cache/SegmentCacheActor.cpp include/normal/core/cache/SegmentCacheActor.h
        src/cache/SegmentCacheActorState.cpp include/normal/core/cache/SegmentCacheActorState.h
        src/graph/OperatorGraph.cpp include/normal/core/graph/OperatorGraph.h
        include/normal/core/cache/SegmentCacheActor2.cpp include/normal/core/cache/SegmentCacheActor2.h
        include/normal/core/SystemActor.cpp include/normal/core/SystemActor.h
        include/normal/core/QueryExecutorActor.cpp include/normal/core/QueryExecutorActor.h
        include/normal/core/Collect.cpp include/normal/core/Collect.h)


target_include_directories(normal-core PUBLIC include)

target_link_libraries(normal-core PRIVATE LLVM-filesystem)
target_link_libraries(normal-core PRIVATE spdlog::spdlog)
target_link_libraries(normal-core PRIVATE fmt::fmt)
target_link_libraries(normal-core PUBLIC caf::libcaf_core_shared)
target_link_libraries(normal-core PUBLIC caf::libcaf_io_shared)
target_link_libraries(normal-core PUBLIC arrow_static)
target_link_libraries(normal-core PUBLIC gandiva_static)
#target_link_libraries(normal-core PUBLIC graphviz_gvc_shared)
#target_link_libraries(normal-core PUBLIC graphviz_dot_layout_shared)
#target_link_libraries(normal-core PUBLIC graphviz_neato_layout_shared)
target_link_libraries(normal-core PUBLIC expected)
target_link_libraries(normal-core PUBLIC normal-expression)
target_link_libraries(normal-core PUBLIC normal-cache)


#-----------------------------------------------------------------------------------------------------------------------
# Test
#-----------------------------------------------------------------------------------------------------------------------

add_executable(normal-core-test
        test/Globals.h
        test/MainTest.cpp
        test/CacheTest.cpp
        test/ActorTest.cpp
        test/SimpleOperator.cpp test/SimpleOperator.h
        test/ErrorOperator.cpp test/ErrorOperator.h)


target_include_directories(normal-core-test PRIVATE include)

target_link_libraries(normal-core-test spdlog::spdlog)
target_link_libraries(normal-core-test doctest::doctest)
target_link_libraries(normal-core-test normal-core)


#-----------------------------------------------------------------------------------------------------------------------
# Diagnostics
#-----------------------------------------------------------------------------------------------------------------------

#showTargetProps(normal-core)
